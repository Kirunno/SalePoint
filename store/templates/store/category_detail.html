{% extends 'store/base.html' %}
{% load static %}

{% block title %}{{ category.name }} — SalePoint{% endblock %}

{% block content %}
<h3 class="mb-3">{{ category.name }}</h3>
<div class="text-muted mb-4">{{ products|length }} товаров</div>

{% if products %}
<div class="row g-3">
    {% for product in products %}
    <div class="col-6 col-md-4 col-lg-3">
        <div class="card h-100">

            <!-- Image block (фиксированная высота) -->
            <a href="{% url 'product_detail' product.id %}">
                <div style="height:180px; display:flex; align-items:center; justify-content:center; background:#f8f9fa;">
                    {% if product.image %}
                        <img src="{{ product.image.url }}" alt="{{ product.name }}" style="max-height:100%; max-width:100%; object-fit:contain;">
                    {% else %}
                        <div class="text-muted small">Нет фото</div>
                    {% endif %}
                </div>
            </a>

            <div class="card-body d-flex flex-column">
                <a href="{% url 'product_detail' product.id %}" class="text-dark text-decoration-none">
                    <div class="fw-semibold" style="font-size:15px; min-height:40px;">
                        {{ product.name }}
                    </div>
                </a>

                <div class="mt-auto">
                    {% if product.old_price %}
                    <div class="text-muted text-decoration-line-through small">
                        {{ product.old_price }} ₸
                    </div>
                    {% endif %}

                    <div class="fw-bold mb-2">{{ product.price }} ₸</div>

                    <form method="post" action="{% url 'add_to_cart' product.id %}">
                        {% csrf_token %}
                        <input type="hidden" name="quantity" value="1">
                        <button class="btn btn-primary btn-sm w-100">В корзину</button>
                    </form>
                </div>
            </div>

        </div>
    </div>
    {% endfor %}
</div>

{% else %}
<div class="text-center text-muted py-5">
    <h4>Товаров нет</h4>
</div>
{% endif %}

{% endblock %}
